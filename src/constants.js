// src/constants.js
const MOSCOW_ZONE = 'Europe/Moscow';

/* -------- нормализация единиц времени -------- */
const timeUnitNormalization = {
  'месяц'  : ['месяц', 'месяца', 'месяцев'],
  'неделя' : ['неделя', 'недели', 'недель', 'неделю'],
  'год'    : ['год', 'года', 'лет'],
  'час'    : ['час', 'часа', 'часов', 'часу'],
  'день'   : ['день', 'дня', 'дней', 'дню'],
  'минута' : ['минута', 'минуты', 'минут', 'минуту'],
  'утро'   : ['утро', 'утром'],
  'вечер'  : ['вечер', 'вечером']
};

const timeUnitMap = {};
Object.entries(timeUnitNormalization).forEach(([nom, forms]) =>
  forms.forEach(f => { timeUnitMap[f.toLowerCase()] = nom; })
);

/* -------- нормализация дней недели ---------- */
const dayOfWeekNormalization = {
  'понедельник': ['понедельник', 'понедельника', 'понедельнику', 'понедельником', 'понедельнике'],
  'вторник'    : ['вторник', 'вторника', 'вторнику', 'вторником', 'вторнике'],
  'среда'      : ['среда', 'среды', 'среду', 'средой', 'среде'],
  'четверг'    : ['четверг', 'четверга', 'четвергу', 'четвергом', 'четверге'],
  'пятница'    : ['пятница', 'пятницы', 'пятницу', 'пятницей', 'пятнице'],
  'суббота'    : ['суббота', 'субботы', 'субботу', 'субботой', 'субботе'],
  'воскресенье': ['воскресенье', 'воскресенья', 'воскресенью', 'воскресеньем', 'воскресенье']
};

const dayOfWeekMap = {};
Object.entries(dayOfWeekNormalization).forEach(([nom, forms]) =>
  forms.forEach(f => { dayOfWeekMap[f.toLowerCase()] = nom; })
);

/* --- Luxon-номер дня недели (1-7) --- */
const dayNameToWeekday = {
  'понедельник': 1,
  'вторник'    : 2,
  'среда'      : 3,
  'четверг'    : 4,
  'пятница'    : 5,
  'суббота'    : 6,
  'воскресенье': 7
};

/* ------------- опечатки / fuzzy -------------- */
const fuzzyCorrections = {
  'миут':'минута', 'миют':'минута', 'миу':'минута',
  'полсезавтра':'послезавтра', 'неделы':'неделя',
  'кажый':'каждый', 'учемба':'учеба',
  'минту':'минута', 'минутка':'минута', 'минутс':'минута',
  'утром':'утро', 'вечером':'вечер'
};

/* ---------------- месяцы --------------------- */
const monthNames = {
  'январь':1,  'января':1,  'январе':1,
  'февраль':2, 'февраля':2, 'феврале':2,
  'март':3,    'марта':3,   'марте':3,
  'апрель':4,  'апреля':4,  'апреле':4,
  'май':5,     'мая':5,     'мае':5,
  'июнь':6,    'июня':6,    'июне':6,
  'июль':7,    'июля':7,    'июле':7,
  'август':8,  'августа':8, 'августе':8,
  'сентябрь':9,'сентября':9,'сентябре':9,
  'октябрь':10,'октября':10,'октябре':10,
  'ноябрь':11, 'ноября':11, 'ноябре':11,
  'декабрь':12,'декабря':12,'декабре':12
};

/* -------------- склонения -------------------- */
const unitDeclensions = {
  'минута': { one:'минута', few:'минуты', many:'минут' },
  'час'   : { one:'час',    few:'часа',   many:'часов' },
  'день'  : { one:'день',   few:'дня',    many:'дней'  },
  'неделя': { one:'неделя', few:'недели', many:'недель'},
  'месяц' : { one:'месяц',  few:'месяца', many:'месяцев'},
  'год'   : { one:'год',    few:'года',   many:'лет'   },
  'утро'  : { one:'утро',   few:'утра',   many:'утр'   },
  'вечер' : { one:'вечер',  few:'вечера', many:'вечеров'}
};

/* ---------------- RegExp --------------------- */
const regexps = {
  /* новая! абсолютная дата + текст, без “каждый …” */
  absoluteDateTextRegex:
    /^(\d{1,2})\s+([а-яё]+)(?:\s+в\s+(\d{1,2}(?::\d{1,2})?))?\s+(.+)$/iu,

  absoluteDateRegex:
    /^(\d{1,2})\s+([а-яё]+)(?:\s+в\s+(\d{1,2}(?::\d{1,2})?))?(?:\s+кажд(?:ый|ая|ую|ое|ые)(?:\s+(\d+)?)?\s+([А-Яа-яёЁ]+)\s+(.+))?$/iu,

  monthlyDayRegex  :
    /^каждый\s+месяц\s+(\d{1,2})\s+(?:числа|день)(?:\s+в\s+(\d{1,2}(?::\d{1,2})?))?\s+(.+)$/iu,

  repeatRegex      :
    /^кажд(?:ый|ая|ую|ое|ые)(?:\s+(\d+))?\s+([А-Яа-яёЁ]+)(?:\s+в\s+(\d{1,2}(?::\d{1,2})?))?(?:\s+(утром|вечером))?\s+(.+)$/iu,

  throughRegex     :
    /^через\s+(?:(\d+(?:\.\d+)?)\s+)?([A-Za-zА-Яа-яёЁ]+)(?:\s+в\s+(\d{1,2}(?::\d{1,2})?))?\s+(.+)$/iu,

  dayMorningEveningRegex:
    /^(сегодня|завтра|послезавтра)\s+(утром|вечером)\s+(.+)$/iu,

  morningEveningRegex   :
    /^(утром|вечером)(?:\s+(сегодня|завтра|послезавтра))?\s+(.+)$/iu,

  todayTomorrowRegex    :
    /^(сегодня|завтра|послезавтра)(?:\s+в\s+(\d{1,2}(?::\d{1,2})?))\s+(.+)$/iu,

  timeWithDotRegex      :
    /^в\s+(\d{1,2})[.:](\d{1,2})\s+(.+)$/iu,

  timeNumericRegex      :
    /^в\s+(\d{3,4})\s+(.+)$/iu,

  timeWithSpaceRegex    :
    /^в\s+(\d{1,2})\s+(\d{2})\s+(.+)$/iu,

  simpleTimeRegex       :
    /^в\s+(\d{1,2})\s+(.+)$/iu
};

/* ---------- сообщения ошибок ----------------- */
const errorMessages = {
  invalidMonth       : 'Некорректное название месяца',
  invalidTime        : 'Некорректное время',
  invalidDate        : 'Некорректная дата',
  invalidRepeatUnit  : 'Недопустимая единица повторения',
  timePassed         : 'Указанное время уже прошло',
  missingText        : 'Не указан текст напоминания',
  complexTime        : 'Сложная временная конструкция, упростите',
  nonPositiveDuration: 'Продолжительность должна быть положительной',
  unknownFormat      : 'Не удалось распознать формат напоминания'
};

/* ------ допустимые repeat-единицы ------------ */
const validRepeatUnits = [
  'минута','час','день','неделя','месяц','год',
  'утро','вечер',
  'понедельник','вторник','среда','четверг',
  'пятница','суббота','воскресенье'
];

/* --------------- экспорт --------------------- */
module.exports = {
  MOSCOW_ZONE,
  timeUnitMap,
  dayOfWeekMap,
  dayNameToWeekday,
  fuzzyCorrections,
  monthNames,
  unitDeclensions,
  regexps,
  errorMessages,
  validRepeatUnits
};